---
title: "컴퓨터 네트워킹 요약 - 3. 트랜스포트 계층
last_modified_at: 2021-02-22
show_date: true
classes: wide
excerpt: ""
categories:
  - computer_networking
---

## 3.1. 트랜스포트 계층 서비스 및 개요(Introduction and Transport-Layer Services)
트랜스포트 계층 프로토콜은 서로 다른 호스트에서 동작하는 애플리케이션 프로세스들 간의 논리적 통신(logical communication)을 제공한다. 
논리적 통신은 애플리케이션의 관점에서 보면, 물리적인 하위 구조를 신경쓰지 않고 프로세스들을 실행하는 호스트들이 직접 연결된 것처럼 보인다는 것을 의미한다. 

### 3.1.1. 트랜스포트 계층과 네트워크 계층사이의 관계(Relationship Between Transport and Network Layers)
트랜스포트 계층은 프로토콜 스택에서 네트워크 계층 바로 상위에 존재한다. 

종단 시스템 안에서, 트랜스포트 프로토콜은 프로세스에서 네트워크 경계(네트워크 계층)까지 메세지를 운반하며, 
또한 반대 방향으로 메세지를 운반한다. 
반면, 네트워크 프로토콜은 라우터를 거쳐 다른 종단 시스템까지 가는 것을 관리한다. 

컴퓨터 네트워크는 애플리케이션에게 서로 다른 서비스를 제공하도록 하는 다양한 트랜스포트 프로토콜을 만들 수 있게 한다. 

트랜스포트 계층이 제공할 수 있는 서비스는 하위 계층인 네트워크 계층의 서비스에 의해서 제약받는다. 
네트워크 계층이 트랜스포트 계층 세그먼트에 대한 지연/대역폭 보장을 제공할 수 없다면, 
트랜스포트 계층은 프로세스끼리 전송하는 메세지에 대한 지연/대역폭 보장을 제공할 수 없다. 

네트워크 계층이 상응하는 서비스를 제공하지 못할 때에도, 특정 서비스는 트랜스포트 계층이 제공할 수도 있다. 
예를 들어, 신뢰적 데이터 전송, 데이터 암호화가 있다. 

### 3.1.2. 인터넷 트랜스포트 계층의 개요(Overview of the Transport Layer in the Internet)
인터넷, 일반적으로 TCP/IP 네트워크에는 비신뢰적이고 비연결형인 UDP과 신뢰적이고 연결지향형인 TCP 프로토콜이 있다. 
트랜스포트 계층 패킷을 세그먼트라고 한다. 

UDP, TCP에 앞서 인터넷의 네트워크 계층의 용어는 다음과 같다. 
네트워크 계층 프로토콜은 인터넷 프로토콜, 줄여서 IP라고 부른다. 
IP 서비스 모델은 호스트들 간에 논리적 통신을 제공하는 최선형 전달 서비스(best-effort delivery service)이다. 
이것은 IP가 세그먼트 전달을 위해 최대한 노력하지만, 전달을 보장하지 않고 세그먼트가 순서대로 전달되는 것도 보장하지 않는다. 
이 때문에, IP를 비신뢰적인 서비스(unreliable service)라 한다. 

UDP와 TCP의 기본적인 기능은 호스트 간의 IP 전달 서비스를 호스트에서 동작하는 두 프로세스 간의 전달 서비스로 확장하는 것이다. 
"호스트-대-호스트 전달"을 "프로세스-대-프로세스"로 확장하는 것을 트랜스포트 다중화(transport multiplexing)와 역다중화(demultiplexing)라고 부른다. 

UDP는 IP와 같이 비신뢰적인 서비스이다. 
전송되는 데이터가 손상되지 않는 것을 보장하지 않는다. 

TCP는 신뢰적인 데이터 전달(reliable data transfer)을 제공한다. 
한 TCP 연결이 과도한 양의 트래픽으로 호스트들 사이의 스위치와 링크에 넘치지(swamping) 않도록 혼잡제어도 제공한다. 
흐름제어, 순서번호, 확인응답, 타이머 등을 사용한다. 

## 3.2. 다중화와 역다중화(Multiplexing and Demultiplexing)
목적지 호스트에서 트랜스포트 계층은 바로 아래의 네트워크 계층으로부터 세그먼트를 수신한다. 
트랜스포트 계층은 호스트에서 동작하는 여러 프로세스 중 올바른 프로세스에게 이 세그먼트의 데이터를 전달한다. 

트랜스포트 계층은 데이터를 직접 프로세스로 전달하지 않는다. 
대신에 중간 매개자인 소켓에게 전달한다. 

트랜스포트 계층 세그먼트의 데이터를 올바른 소켓으로 전달하는 작업을 역다중화라고 한다. 
출발지 호스트에서 소켓으로부터 데이터를 모으고, 세그먼트를 생성하기 위해 데이터에 헤더 정보(역다중화에 필요)로 캡슐화하고, 
세그먼트를 네트워크 계층으로 전달하는 작업을 다중화라고 한다. 

다중화에는 두 가지 요구사항이 필요하다. 
첫째, 소켓은 유일한 식별자를 가진다. 
둘째, 각 세그먼트를 세그먼트가 전달될 소켓을 가르키는 특별한 필드를 가진다. 
즉, 출발지 포트 번호 필드(source port number field)와 목적지 포트 번호 필드(destination port number field)이다. 

호스트의 각 소켓은 포트 번호를 할당받는다. 
세그먼트가 호스트에 도착하면, 트랜스포트 계층은 목적지 포트 번호를 검사하고 상응하는 소켓으로 세그먼트를 보낸다. 
그러면 세그먼트의 데이터는 소켓을 통해 프로세스로 전달된다. 

### 3.2.1. 비연결형 다중화와 역다중화(Connectionless Multiplexing and Demultiplexing)
```python
clientSocket = socket(AF_INET, SOCK_DGRAM) // UDP 소켓 생성, 트랜스포트 계층이 포트 번호 자동으로 사용되지 않는 번호 할당
clientSocket.bind(('', 19157))		   // 포트 번호 명시
```
트랜스포트 계층이 세그먼트를 네트워크 계층에 전달하면, 
네트워크 계층은 세그먼트를 IP 데이터그램으로 캡슐화하고 최선형 전달 서비스로 수신 호스트로 전달한다. 

수신 호스트에서 세그먼트 목적지 포트를 검사하여 적절한 소켓으로 세그먼트를 보낸다. 
즉, (목적지 IP, 목적지 포트)가 식별에 사용된다. 
출발지 포트는 수신 호스트가 송신 호스트에게 보내기 원할 때 사용된다. 

### 3.2.2. 연결지향형 다중화와 역다중화(Connection-Oriented Multiplexing and Demultiplexing)
2.7.2절에서 살펴보았듯이 TCP 서버는 환영 소켓과 각 클라이언트에 대응되는 소켓을 가지고 있다. 
따라서, UDP 소켓과 달리 TCP 소켓은 (출발지 IP, 출발지 포트 번호, 목적지 IP, 목적지 포트)가 식별에 필요하다. 

### 3.2.3. 웹 서버와 TCP(Web Servers and TCP)
TCP을 사용하는 HTTP 웹 서버는 각각의 연결에 따라서 새로운 프로세스를 만든다. 
이들 프로세스는 각자 연결 소켓을 가지며, 이 연결 소켓을 통해서 HTTP 요청을 수신하고 응답한다. 

그러나 오늘날의 많은 웹 서버들은 하나의 프로세스만 사용한다. 
각각의 새로운 클라이언트 연결을 위해 새로운 연결 소켓과 함께 새로운 스레드를 생성한다. 

## 3.3. 비연결형 트랜스포트: UDP(Connectionless Transport: UDP)
UDP는 신뢰적인 데이터 전송 서비스를 제공하지 않지만, 아래와 같은 장점을 지닌다.

UDP에서는 프로세스가 무슨 데이터를 언제 보낼지 더 정교하게 제어할 수 있다. 
프로세스가 데이터를 UDP에 전달하자마자, 세그먼트가 만들어지고 즉시 네트워크 계층으로 전달된다. 
애플리케이션이 UDP의 기본 세그먼트 전달 외에 필요한 기능을 구현할 수 있다. 

UDP는 연결 설정이 없다. 
TCP처럼 세 방향 핸드셰이크를 하지 않으며, 예비동작 없이 데이터를 전송한다. 

UDP는 연결 상태가 없다. 
TCP는 종단 시스템에서 연결 상태(버퍼, 혼잡제어 파라미터 등)을 유지한다. 
UDP는 어떤 것도 기록하지 않는다. 

TCP가 세그먼트마다 20바이트의 헤더 오버헤드를 갖는 반면에 UDP는 단지 8바이트의 오버헤드를 가진다. 

이런 장점이 있기에, 적은 양의 패킷 손실이 허용되는 애플리케이션들은 UDP를 사용할 수도 있다. 
| 애플리케이션 | 애플리케이션 계층 프로토콜 | 하위 트랜스포트 프로토콜 |
|:--------:|:-------:|:--------:|
| 전자메일 | SMTP    | TCP   |
| 웹        | HTTP   | TCP   |
| 파일 전송 | FTP    | TCP   |
| 스티리밍 멀티미디어 | 통상 독점 프로토콜 | UDP 또는 TCP |
| 네트워크 관리 | SNMP | 일반적으로 UDP |
| 이름 변환 | DNS | 일반적으로 UDP |

### 3.3.1. UDP 세그먼트 구조(UDP Segment Structure)
UDP 세그먼트에는 출발지 포트 번호, 목적지 포트 번호, 길이, 체크섬(checksum), 애플리케이션 데이터가 있다. 
* 포트번호는 역다중화를 위해 쓰인다. 
* 길이는 헤더를 포함하는 UDP 세그먼트의 길이를 나타낸다. 
* 체크섬은 세그먼트에 오류가 발생했는지를 검사하기 위해 수신 호스트에 의해 사용된다. 
* 애플리케이션 데이터는 DNS 질의 응답, 비디오 샘플 등이 있다. 

### 3.3.2. UDP 체크섬(UDP Checksum)
UDP 체크섬은 오류 검출을 제공한다. 
즉, 체크섬은 세그먼트가 출발지로부터 목적지로 이동 했을 때, 
세그먼트 안의 비트에 대한 변경사항(예: 링크의 잡음에 의해서 또는 라우터에서 저장되는 동안)이 있는지 검사한다. 

UDP는 세그먼트 안에 있는 16비트 워드를 전부 더한 후에 1의 보수를 수행한다. 
이때 최상위 비트에서 발생하는 오버플로우는 버린다. 
```console
// 3개의 워드가 있다고 가정

// 아래 세개 워드를 더함
0110011001100000
0101010101010101
1000111100001100

// 먼저 위의 두개를 더함
0110011001100000
0101010101010101
----------------
1011101110110101

// 위의 결과와 세번째 비트를 더함, 맨 왼쪽 오버플로우는 버려짐
1011101110110101
1000111100001100
----------------
0100101011000010

// 1의 보수를 취함
1011010100111101
```

수신자에서는 체크섬을 포함한 4개의 모든 16비트 워드들을 더한다. 
만약 패킷에 오류가 없다면, 수신자에서의 합은 1111111111111111이 된다. 
하나라도 0이 있다면 오류가 발생한 것이다. 

어떤 링크 계층 프로토콜은 오류 검사를 수행하지 않고, 
세그먼트가 라우터의 메모리에 저장될 때 비트 오류가 생길 수 있으므로, 
트랜스포트 계층에서 오류 검사를 해야한다. 

그러나 UDP는 오류가 생겨도 이를 회복하지 않는다. 
손상된 세그먼트를 그냥 버리거나, 경고와 함께 손상된 세그먼트를 애플리케이션에게 넘겨준다. 

## 3.4. 신뢰성 있는 데이터 전송의 원리(Principles of Reliable Data Transfer)
 


