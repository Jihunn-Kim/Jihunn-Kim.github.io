---
title: "운영체제 요약 - 6. 프로세스 동기화"
last_modified_at: 2021-01-30
excerpt: ""
categories:
  - operating_system
---

## 1. 배경
두 개의 프로세스가 동시에 공유 데이터를 조작한다면 의도치 않은 결과가 나올 수 있다. 
실행 결과가 접근이 발생한 순서에 따라 바뀌는 상황을 경쟁 상황(race condition)이라고 한다. 
이런 경쟁 상황으로부터 보호하기 위해, 한 순간에 한 프로세스만이 공유 데이터를 조작하도록 프로세스들을 동기화해야 한다. 

## 2. 임계구역 문제(The Critical-Section Problem)
각 프로세스는 임계구역이라 불리는 코드 부분을 포함하고 있을 수 있다. 
이 코드는 공유 데이터를 조작한다. 

프로세스가 임계구역에 진입하려면 진입허가를 요청해야 한다. 
요청을 하는 코드 부분을 진입 구역(entry section), 임계구역 뒤에는 퇴출 구역(exit section)이라 한다. 

임계구역 문제에 대한 해결안은 다음의 세 가지 요구조건을 충족해야 한다. 
* 상호 배제(mutual exclusion)
	- 한 프로세스가 임계구역에서 실행된다면, 다른 프로세스들은 임계구역에서 실행될 수 없다.
* 진행(progress)
	- 임계구역이 실행되지 않고 있다면, 다음에 어떤 프로세스들이 임계구역에 진입할지 정해야 한다.
* 한정된 대기(bounded waiting)
	- 한 프로세스가 무한히 임계구역에 들어가지 못하면 안된다. 

## 3. 피터슨의 해결안(Peterson's Solution)
더이상 쓰이지 않는다. 단지 두 개의 프로세스만 있다고 가정된다. 
임계구역 진입 순번 turn, 임계구역 진입 준비 완료 flag 공유 변수를 진입 구역과 퇴출 구역에서 조작한다. 

## 4. 동기화 하드웨어(Synchronization Hardware)
단일 처리기 환경에서 임계구역 문제는 공유 데이터가 변경되는 동안 인터럽트 발생을 막음으로써 해결할 수 있다. 

다중 처리기 환경에서는 하드웨어 명령어를 통해 임계구역 문제를 해결할 수 있다. 
많은 기계들은 한 워드(word)의 내용을 검사하고 변경하거나, 두 워드의 내용을 원자적으로 교환할 수 있는, 즉 인터럽트 되지 않는 하나의 단위로서, 특별한 하드웨어 명령어를 제공한다. 
```console
Boolean test_and_set(boolean *target) {
	boolean rv = *target;
	*target = true;
	return rv;
}

while(test_and_set(&lock));

// critical section

lock = false;

```

test_and_set은 특정 기계 명령어의 추상화된 형태이다. 
만약 두 개의 CPU에서 명령어가 동시에 실행된다면, 임의의 순서로 ``순차적으로`` 실행될 것이다. 

## 5. Mutex Locks
하드웨어 기반 해결책은 응용 프로그래머는 사용할 수가 없다. 
따라서 mutext lock 이라는 소프트웨어 도구를 사용한다. 
프로세스는 임계구역에 들어가기 전에 반드시 lock을 획득해야 하고 임계구역을 빠져 나올 때 lock을 반환해야 한다. 
획득과 반환 함수는 원자적으로 수행되어야 하므로 하드웨어 기법을 통해 구현된다. 

